<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>App PC - RÃ©ception Notifications</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
body { font-family: sans-serif; padding: 1em; background:#f5f5f5; }
.notif { background:white; padding:1em; margin-bottom:0.5em; border-radius:8px; }
.music { font-style:italic; color:#555; }
img { max-width:100%; margin-top:0.5em; border-radius:8px; }
</style>
</head>
<body>
<h3>Notifications reÃ§ues</h3>
<div id="container"></div>

<script>
const supabaseUrl = 'https://mymmjduelbpownsqdzgu.supabase.co';
const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im15bW1qZHVlbGJwb3duc3Fkemd1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIzNjQ4OTcsImV4cCI6MjA3Nzk0MDg5N30.qNPmhC3gwJUb7rziwniPK33fjMEMEdvw-pa0EI1yju8';
const supabase = supabase.createClient(supabaseUrl, supabaseKey);
const container = document.getElementById('container');

function addNotif(n){
  const div = document.createElement('div');
  div.className = 'notif';
  let html = '';
  if(n.type === 'text') html += `<div>${n.content}</div>`;
  if(n.type === 'music') html += `<div class="music">ðŸŽµ ${n.music_title}</div>`;
  if(n.image_url) html += `<img src="${n.image_url}" />`;
  if(n.type === 'notif' && n.content) html += `<div>ðŸ”” ${n.content}</div>`;
  div.innerHTML = html;
  container.prepend(div);
}

// Charger notifications existantes
async function loadExisting() {
  const { data } = await supabase.from('notifications').select('*').order('created_at',{ascending:false});
  data.forEach(addNotif);
}
loadExisting();

// Realtime
supabase.channel('notif_channel')
  .on('postgres_changes', { event:'INSERT', schema:'public', table:'notifications' },
      payload => addNotif(payload.new))
  .subscribe();
</script>
</body>
</html>
